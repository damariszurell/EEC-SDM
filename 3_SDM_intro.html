<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Introduction to SDMs: simple model fitting</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Species distribution modelling</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="schedule.html">Course schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R practicals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="0_Intro.html">0. Introduction to R</a>
    </li>
    <li>
      <a href="1_SpeciesData.html">1. Species data</a>
    </li>
    <li>
      <a href="2_EnvData.html">2. Environmental data</a>
    </li>
    <li>
      <a href="3_SDM_intro.html">3. SDMs: simple model fitting</a>
    </li>
    <li>
      <a href="4_SDM_eval.html">4. SDMs: assessment and prediction</a>
    </li>
    <li>
      <a href="5_pseudoabsence.html">5. Pseudo-absence and background data</a>
    </li>
    <li>
      <a href="6_SDM_algorithms.html">6. SDMs: algorithms</a>
    </li>
    <li>
      <a href="7_SDM_ensembles.html">7. SDMs: ensembles</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://damariszurell.github.io">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/ZurellLab">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Introduction to SDMs: simple model fitting</h1>

</div>


<div class="alert alert-info">
<p><strong>RStudio project</strong></p>
<p>Open the RStudio project that we created in the first session. I recommend to use this RStudio project for the entire course and within the RStudio project create separate R scripts for each session.</p>
<ul>
<li>Create a new empty R script by going to the tab “File”, select “New File” and then “R script”</li>
<li>In the new R script, type <code># Session 3: SDM introduction</code> and save the file in your folder “scripts” within your project folder, e.g. as “3_SDM_intro.R”</li>
</ul>
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>This session will introduce you to simple species distribution models (SDMs). Species distribution models (SDMs) are a popular tool in quantitative ecology <span class="citation">(Franklin 2010; Peterson et al. 2011; Guisan, Thuiller, and Zimmermann 2017)</span> and constitute the most widely used modelling framework in global change impact assessments for projecting potential future range shifts of species <span class="citation">(IPBES 2016)</span>. There are several reasons that make them so popular: they are comparably easy to use because many software packages <span class="citation">(e.g. Thuiller et al. 2009; Phillips, Anderson, and Schapire 2006)</span> and guidelines <span class="citation">(e.g. Elith, Leathwick, and Hastie 2008; Elith et al. 2011; Merow, Smith, and Silander Jr 2013; Guisan, Thuiller, and Zimmermann 2017)</span> are available, and they have comparably low data requirements.</p>
<p>SDMs relate biodiversity observations (e.g. presence-only, presence/absence, abundance, species richness) at specific sites to the prevailing environmental conditions at those sites. Different statistical and machine-learning algorithms are available for this. Based on the estimated biodiversity-environment relationship, we can make predictions in space and in time by projecting the model onto available environmental layers (Figure 1).</p>
<p><img src="figures/sdm.png" title="**Figure 1. Schematic representation of the species distribution modelling concept. First, biodiversity and environmental information are sampled in geographic space. Second, a statistical model (here, generalised linear model) is used to estimate the species-environment relationship. Third, the species–environment relationship can be mapped onto geographic layers of environmental information to delineate the potential distribution of the species. Mapping to the sampling area and period is usually referred to as interpolation, while transferring to a different time period or geographic area is referred to as extrapolation.**" alt="**Figure 1. Schematic representation of the species distribution modelling concept. First, biodiversity and environmental information are sampled in geographic space. Second, a statistical model (here, generalised linear model) is used to estimate the species-environment relationship. Third, the species–environment relationship can be mapped onto geographic layers of environmental information to delineate the potential distribution of the species. Mapping to the sampling area and period is usually referred to as interpolation, while transferring to a different time period or geographic area is referred to as extrapolation.**" width="70%" /></p>
<p>We distinguish five main modelling steps for SDMs: (i) conceptualisation, (ii) data preparation, (iii) model fitting, (iv) model assessment, and (v) prediction (Figure 2.). The last step (prediction) is not always part of SDM studies but depends on the model objective <span class="citation">(Zurell et al. 2020)</span>. Generally, we distinguish three main objectives for SDMs: (a) inference and explanation, (b) mapping and interpolation, and (c) forecast and transfer. I recommend getting more familiar with critical assumptions and modelling decisions by studying the many excellent review articles <span class="citation">(Guisan and Zimmermann 2000; Guisan and Thuiller 2005; Elith and Leathwick 2009)</span> and textbooks on SDMs <span class="citation">(Peterson et al. 2011; Franklin 2010; Guisan, Thuiller, and Zimmermann 2017)</span>.</p>
<p>I would also like to emphasise that model building is an iterative process and there is much to learn on the way. In consequence, you may want to revisit and improve certain modelling steps, for example improve the spatial sampling design. Because of that I like to regard model building as a cycle rather than a workflow with a pre-defined termination point (Figure 2.)<span class="citation">(Zurell et al. 2020)</span>.</p>
<p><img src="figures/sdm_steps.png" title="**Figure 2. The main modelling cycle in species distribution modelling.**" alt="**Figure 2. The main modelling cycle in species distribution modelling.**" width="50%" /></p>
<div id="prac-overview" class="section level2">
<h2><span class="header-section-number">1.1</span> Prac overview</h2>
<p>In this session, we will only work with Generalised Linear Models (GLMs) and concentrate on the first three model building steps (Figure 2.)</p>
</div>
<div id="generalised-linear-models-glms" class="section level2">
<h2><span class="header-section-number">1.2</span> Generalised linear models (GLMs)</h2>
<p>Why do we not simply use linear regression to fit our species-environment relationship? Well, strictly, ordinary least squares (OLS) linear regression is only valid if the response (or rather the error) is normally distributed and ranges (<span class="math inline">\(-\infty,\infty\)</span>). OLS regression looks like this</p>
<p><span class="math display">\[E(Y|X)=\beta X+\epsilon\]</span></p>
<p>where <span class="math inline">\(E(Y|X)\)</span> is the <em>conditional mean</em>, meaning the expected value of the response <span class="math inline">\(Y\)</span> given the environmental predictors <span class="math inline">\(X\)</span> <span class="citation">(Hosmer and Lemeshow 2013)</span>. <span class="math inline">\(X\)</span> is the matrix of predictors (including the intercept), <span class="math inline">\(\beta\)</span> are the coefficients for the predictors, and <span class="math inline">\(\epsilon\)</span> is the (normally distributed!) error term. <span class="math inline">\(\beta X\)</span> is referred to as the linear predictor.</p>
<p>When we want to predict species occurrence based on environment, then the conditional mean <span class="math inline">\(E(Y|X)\)</span> is binary and bounded between 0 (absence) and 1 (presence). Thus, the assumptions of OLS regression are not met. GLMs are more flexible regression models that allow the response variable to follow other distributions. Similar to OLS regression, we also fit a linear predictor <span class="math inline">\(\beta X\)</span> and then relate this linear predictor to the mean of the response variable using a link function. The link function is used to transform the response to normality. In case of a binary response, we typically use the logit link (or sometimes the probit link). The conditional mean is then given by:</p>
<p><span class="math display">\[E(Y|X) = \pi (X) = \frac{e^{\beta X+\epsilon}}{1+e^{\beta X+\epsilon}}\]</span></p>
<p>The logit transformation is defined as: <span class="math display">\[g(X)  = ln \left( \frac{\pi (X)}{1-\pi (X)} \right)   = \beta X+\epsilon\]</span></p>
<p>The trick is that the logit, g(X), is now linear in its parameters, is continuous and may range (<span class="math inline">\(-\infty,\infty\)</span>). GLMs with a logit link are also called logistic regression models.</p>
</div>
</div>
<div id="conceptualisation" class="section level1">
<h1><span class="header-section-number">2</span> Conceptualisation</h1>
<p>In the conceptualisation phase, we formulate our main research objectives and decide on the model and study setup based on any previous knowledge on the species and study system. An important point here is whether we can use available data or have to gather own biodiversity (and environmental) data, which would require deciding on an appropriate sampling design. Then, we carefully check the main underlying assumptions of SDMs, for example whether the species is in pseudo-equilibrium with environment and whether the data could be biased in any way <span class="citation">(cf. chapter 5 in Guisan, Thuiller, and Zimmermann 2017)</span>. The choice of adequate environmental predictors, of modelling algorithms and of desired model complexity should be guided by the research objective and by hypotheses regarding the species-environment relationship. We can divide environmental variables into three types of predictors: resource variables, direct variables and indirect variables <span class="citation">(Austin 1980; Guisan and Zimmermann 2000)</span>.</p>
<div id="example-ring-ouzel" class="section level2">
<h2><span class="header-section-number">2.1</span> Example: Ring Ouzel</h2>
<p>We aim at assessing potential climate change effects on the Ring Ouzel (<em>Turdus torquatus</em>) in UK (Figure 3), a typical upland bird. First, we try to make ourselves familiar with Ring Ouzel ecology. For example, the RSPB in UK (The Royal Society for the Protection of Birds) as well as the IUCN (Internatinal Union for the Conservation of Nature) provide some species details on their websites (<a href="https://www.rspb.org.uk/birds-and-wildlife/wildlife-guides/bird-a-z/ring-ouzel/">RSPB</a>, <a href="https://www.iucnredlist.org/species/22708768/155629409">IUCN</a>). Think about which factors could limit the distribution of Ring Ouzel in UK.</p>
<p><img src="figures/ringouzel.png" title="A male ring ouzel. Copyright Ruedi Aeschlimann. Downloaded from www.vogelwarte.ch." alt="A male ring ouzel. Copyright Ruedi Aeschlimann. Downloaded from www.vogelwarte.ch." width="40%" /></p>
</div>
</div>
<div id="data-preparation" class="section level1">
<h1><span class="header-section-number">3</span> Data preparation</h1>
<p>In this step, the actual biodiversity and environmental data are gathered and processed. This concerns all data that are required for model fitting but also data that are used for making transfers. In the previous sessions, you have already explored some ways to retrieve species data and environmental data. To simplify matters a little bit, I provide the processed data for this example, which you can download from <a href="data/Prac3_data.zip">here</a> (or from the data folder in moodle). The data frame contains ring ouzel presences and absences as well as bioclimatic data.</p>
<p>The ring ouzel occurrence records were obtained from the British breeding and wintering birds citizen science atlas <span class="citation">(Gillings et al. 2019)</span>. The atlas contains breeding bird records in 20-year cycles (1968-1972, 1988-1991, 2008-2011 and) wintering bird records in 30-year cycles (1981/1982-1983-1984, 2007/2008-2010/2011) at a 10 km spatial resolution throughout Britain, Ireland, the Isle of Man and the Channel Islands. The entire atlas data are available through the British Trust of Ornithology (www.bto.org) and can be downloaded <a href="https://www.bto.org/sites/default/files/atlas_open_data_files.zip">here</a>. I already extracted the confirmed breeding occurrences of the ring ouzel for the most recent atlas period 2008-2011. As absence data I used those locations where no ring ouzel occurrence was reported. Afterwards I spatially thinned the data such that all presence and absence locations are at least 20 km apart. This is important to avoid problems with spatial autocorrelation. The 19 bioclimatic variables were extracted from the worldclim data base (see detail on the variables <a href="https://www.worldclim.org/data/bioclim.html">here</a>).</p>
<p>Read in the data table:</p>
<pre class="r"><code>library(raster)
bg &lt;- raster(&#39;data/Prac3_UK_mask.grd&#39;)</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded datum OSGB 1936 in CRS definition</code></pre>
<pre class="r"><code>sp_dat &lt;- read.table(&#39;data/Prac3_RingOuzel.txt&#39;,header=T)</code></pre>
<p>Inspect the data, and plot the presence and absence locations:</p>
<pre class="r"><code>summary(sp_dat)</code></pre>
<pre><code>##     EASTING          NORTHING       Turdus_torquatus       bio1       
##  Min.   : 55000   Min.   :  15000   Min.   :0.00000   Min.   : 35.72  
##  1st Qu.:255000   1st Qu.: 235000   1st Qu.:0.00000   1st Qu.: 78.04  
##  Median :345000   Median : 405000   Median :0.00000   Median : 87.82  
##  Mean   :354053   Mean   : 469892   Mean   :0.08481   Mean   : 86.13  
##  3rd Qu.:445000   3rd Qu.: 695000   3rd Qu.:0.00000   3rd Qu.: 96.03  
##  Max.   :655000   Max.   :1215000   Max.   :1.00000   Max.   :109.11  
##       bio2            bio3            bio4           bio5      
##  Min.   :41.00   Min.   :30.00   Min.   :3069   Min.   :134.0  
##  1st Qu.:62.72   1st Qu.:34.00   1st Qu.:4213   1st Qu.:176.1  
##  Median :69.56   Median :35.26   Median :4472   Median :190.0  
##  Mean   :67.30   Mean   :35.23   Mean   :4387   Mean   :189.5  
##  3rd Qu.:72.68   3rd Qu.:36.44   3rd Qu.:4688   3rd Qu.:206.3  
##  Max.   :81.78   Max.   :39.82   Max.   :5211   Max.   :230.3  
##       bio6               bio7            bio8             bio9       
##  Min.   :-55.4892   Min.   :129.8   Min.   :-12.40   Min.   : 35.62  
##  1st Qu.: -4.2466   1st Qu.:178.9   1st Qu.: 41.95   1st Qu.: 60.23  
##  Median :  1.8448   Median :192.3   Median : 54.05   Median : 88.25  
##  Mean   :  0.9743   Mean   :188.5   Mean   : 59.08   Mean   : 87.43  
##  3rd Qu.:  8.2466   3rd Qu.:201.5   3rd Qu.: 70.35   3rd Qu.:105.35  
##  Max.   : 29.4952   Max.   :226.1   Max.   :162.00   Max.   :152.06  
##      bio10           bio11            bio12            bio13       
##  Min.   :102.2   Min.   :-23.40   Min.   : 539.7   Min.   : 52.00  
##  1st Qu.:132.6   1st Qu.: 26.73   1st Qu.: 694.5   1st Qu.: 72.00  
##  Median :145.7   Median : 34.06   Median : 881.6   Median : 95.83  
##  Mean   :143.8   Mean   : 32.14   Mean   : 965.6   Mean   :106.80  
##  3rd Qu.:156.2   3rd Qu.: 39.06   3rd Qu.:1162.1   3rd Qu.:132.64  
##  Max.   :173.3   Max.   : 56.82   Max.   :1980.9   Max.   :249.98  
##      bio14            bio15           bio16           bio17      
##  Min.   : 31.00   Min.   : 8.00   Min.   :148.5   Min.   :108.0  
##  1st Qu.: 44.71   1st Qu.:14.00   1st Qu.:203.9   1st Qu.:146.1  
##  Median : 53.36   Median :19.79   Median :278.7   Median :171.5  
##  Mean   : 56.28   Mean   :19.53   Mean   :306.8   Mean   :179.9  
##  3rd Qu.: 64.61   3rd Qu.:25.00   3rd Qu.:387.7   3rd Qu.:202.8  
##  Max.   :100.99   Max.   :31.19   Max.   :689.3   Max.   :316.9  
##      bio18           bio19      
##  Min.   :141.0   Min.   :121.6  
##  1st Qu.:169.0   1st Qu.:177.8  
##  Median :198.0   Median :248.1  
##  Mean   :210.5   Mean   :270.8  
##  3rd Qu.:240.4   3rd Qu.:340.5  
##  Max.   :366.2   Max.   :641.4</code></pre>
<pre class="r"><code># Plot GB land mass
plot(bg,col=&#39;grey&#39;,axes=F,legend=F)
# Plot presences in red and absences in black
plot(extend(rasterFromXYZ(sp_dat[,1:3]),bg), col=c(&#39;black&#39;,&#39;red&#39;), legend=F,add=T)</code></pre>
<p><img src="3_SDM_intro_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="model-fitting" class="section level1">
<h1><span class="header-section-number">4</span> Model fitting</h1>
<div id="fitting-our-first-glm" class="section level2">
<h2><span class="header-section-number">4.1</span> Fitting our first GLM</h2>
<p>Before we start into the complexities of the different model fitting steps, let us look at a GLM in more detail. We fit our first GLM with only one predictor assuming a linear relationship between response and predictor. The <code>glm</code> function is contained in the R <em>stats</em> package. We need to specify a <em>formula</em> describing how the response should be related to the predictors, and the <em>data</em> specifying the data frame that contains the response and predictor variables, and a <em>family</em> argument specifying the type of response and the link function. In our case, we use the <em>logit</em> link in the <em>binomial</em> family.</p>
<pre class="r"><code># We first fit a GLM for the bio11 variable assuming a linear relationship:
m1 &lt;- glm(Turdus_torquatus ~ bio11, family=&quot;binomial&quot;, data= sp_dat)
    
# We can get a summary of the model:
summary(m1) </code></pre>
<pre><code>## 
## Call:
## glm(formula = Turdus_torquatus ~ bio11, family = &quot;binomial&quot;, 
##     data = sp_dat)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8183  -0.2813  -0.1803  -0.1157   3.1911  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.60045    0.44867   3.567 0.000361 ***
## bio11       -0.16071    0.01978  -8.126 4.44e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 294.43  on 506  degrees of freedom
## Residual deviance: 176.39  on 505  degrees of freedom
## AIC: 180.39
## 
## Number of Fisher Scoring iterations: 7</code></pre>
</div>
<div id="more-complex-glms" class="section level2">
<h2><span class="header-section-number">4.2</span> More complex GLMs</h2>
<p>We can also fit quadratic or higher polynomial terms (check <code>?poly</code>) and interactions between predictors:<br />
- the term <code>I()</code>indicates that a variable should be transformed before being used as predictor in the formula<br />
- <code>poly(x,n)</code> creates a polynomial of degree <span class="math inline">\(n\)</span>: <span class="math inline">\(x + x^2 + ... + x^n\)</span><br />
- <code>x1:x2</code> creates a two-way interaction term between variables x1 and x2, the linear terms of x1 and x2 would have to be specified separately<br />
- <code>x1*x2</code> creates a two-way interaction term between variables x1 and x2 plus their linear terms<br />
- <code>x1*x2*x3</code> creates the linear terms of the three variables, all possible two-way interactions between these variables and the three-way interaction</p>
<p>Try out different formulas:</p>
<pre class="r"><code># Fit a quadratic relationshop with bio1:
m1_q &lt;- glm(Turdus_torquatus ~ bio11 + I(bio11^2), family=&quot;binomial&quot;, data= sp_dat)
summary(m1_q)
    
# Or use the poly() function:
summary( glm(Turdus_torquatus ~ poly(bio11,2) , family=&quot;binomial&quot;, data= sp_dat) )

# Fit two linear variables:
summary( glm(Turdus_torquatus ~ bio11 + bio8, family=&quot;binomial&quot;, data= sp_dat) )

# Fit three linear variables:
summary( glm(Turdus_torquatus ~ bio11 + bio8 + bio17, family=&quot;binomial&quot;, data= sp_dat) )

# Fit three linear variables with up to three-way interactions
summary( glm(Turdus_torquatus ~ bio11 * bio8 * bio17, family=&quot;binomial&quot;, data= sp_dat) )

# Fit three linear variables with up to two-way interactions
summary( glm(Turdus_torquatus ~ bio11 + bio8 + bio17 + 
               bio11:bio8 + bio11:bio17 + bio8:bio17, 
             family=&quot;binomial&quot;, data= sp_dat) )</code></pre>
</div>
<div id="important-considerations-during-model-fitting" class="section level2">
<h2><span class="header-section-number">4.3</span> Important considerations during model fitting</h2>
<p>Model fitting is at the heart of any SDM application. Important aspects to consider during the model fitting step are:</p>
<ul>
<li>How to deal with multicollinearity in the environmental data?</li>
<li>How many variables should be included in the model (without overfitting) and how should we select these?</li>
<li>Which model settings should be used?</li>
<li>When multiple model algorithms or candidate models are fitted, how to select the final model or average the models?</li>
<li>Do we need to test or correct for non-independence in the data (spatial or temporal autocorrelation, nested data)?</li>
<li>Do we want to threshold the predictions, and which threshold should be used?</li>
</ul>
<p>More detailed descriptions on these aspects can be found in <span class="citation">Franklin (2010)</span> and in <span class="citation">Guisan, Thuiller, and Zimmermann (2017)</span>.</p>
</div>
<div id="collinearity-and-variable-selection" class="section level2">
<h2><span class="header-section-number">4.4</span> Collinearity and variable selection</h2>
<p>GLMs (and many other statistical models) have problems to fit stable parameters if two or more predictor variables are highly correlated, resulting in so-called multicollinearity issues <span class="citation">(Dormann et al. 2013)</span>. To avoid these problems here, we start by checking for multi-collinearity and by selecting an initical set of predictor variables. Then, we can fit our GLM including multiple predictors and with differently complex response shapes. This model can then be further simplified by removing “unimportant” predictors.</p>
<div id="correlation-among-predictors" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Correlation among predictors</h3>
<p>We first check for pairwise correlations among predictors. Generally, correlations below |r|&lt;0.7 are considered unproblematic (or below |r|&lt;0.5 as more conservative threshold).</p>
<pre class="r"><code>library(corrplot)

# We first estimate a correlation matrix from the predictors. 
# We use Spearman rank correlation coefficient, as we do not know 
# whether all variables are normally distributed.
cor_mat &lt;- cor(sp_dat[,-c(1:3)], method=&#39;spearman&#39;)

# We can visualise this correlation matrix. For better visibility, 
# we plot the correlation coefficients as percentages.
corrplot.mixed(cor_mat, tl.pos=&#39;lt&#39;, tl.cex=0.6, number.cex=0.5, addCoefasPercent=T)</code></pre>
<p><img src="3_SDM_intro_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Several predictor variables are highly correlated. One way to deal with this issue is to remove the “less important” variable from the highly correlated pairs. For this, we need to assess variable importance.</p>
</div>
<div id="deviance-and-aic" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Deviance and AIC</h3>
<p>Before we can assess univariate variable importance, we need to know how!</p>
<p>Basically, we want to know whether a predictor is “important”. We thus need to evaluate whether a model including this variable tells us more about the response than a model without that variable <span class="citation">(Hosmer and Lemeshow 2013)</span>. Importantly, we do not look at the significance level of predictors. Such p-values merely tell us whether the slope coefficient is significantly different from zero. Rather, we assess whether the predicted values are closer to the observed values when the variable is included in the model versus when it is not included. In logistic regression, we compare the observed to predicted values using the log-likelihood function:</p>
<p><span class="math display">\[L( \beta ) = ln[l( \beta)] = \sum_{i=1}^{n} \left( y_i \times ln[\pi (x_i)] + (1-y_i) \times ln[1- \pi (x_i)] \right)\]</span></p>
<p><span class="math inline">\(L( \beta )\)</span> is the <em>Likelihood of the fitted model</em>. From this, we can calculate the deviance <span class="math inline">\(D\)</span> defined as:</p>
<p><span class="math display">\[D = -2 \times L\]</span></p>
<p>This deviance is an important measure used for comparing models. For example, it serves for the calculation of <em>Information criteria</em> that are used for comparing models containing different numbers of parameters. Here, we will use the <em>Akaike Information Criterion</em>, usually abbreviated as AIC. It is defined as: <span class="math display">\[AIC = -2 \times L + 2 \times (p+1) = D + 2 \times (p+1)\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the number of regression coefficients in the model. AIC thus takes into account model complexity. In general, lower values of AIC are preferable.</p>
<p>We can also use the deviance to calculate the <em>Explained deviance</em> <span class="math inline">\(D^2\)</span>, which is the amount of variation explained by the model compared to the null expectation: <span class="math display">\[D^2 = 1 - \frac{D(model)}{D(Null.model)}\]</span></p>
</div>
<div id="univariate-variable-importance" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Univariate variable importance</h3>
<p><span class="citation">Dormann et al. (2013)</span> suggest to assess univariate variable importance in terms of AIC (Akaike information criterion) or explained deviance (in GLMs, we speak of deviance instead of variance). In practice, this means that we fit a GLM separately for each predictor, assess the importance and then rank the variables according to their univariate importance.</p>
<p>Earlier, we already fitted GLMs with linear and quadratic terms. We can now easily extract the AIC from the fitted model objects. Which model is better in terms of AIC?</p>
<pre class="r"><code>AIC(m1) </code></pre>
<pre><code>## [1] 180.3946</code></pre>
<pre class="r"><code>AIC(m1_q)</code></pre>
<pre><code>## [1] 181.8804</code></pre>
<p>Including the possibility of a quadratic (unimodal) relationship seems sensible.</p>
</div>
<div id="variable-selection-removing-highly-correlated-variables" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Variable selection: removing highly correlated variables</h3>
<p>Now, it’s getting a bit more complicated. We need to identify all pairs of variables that have correlation |r|&gt;0.7 and remove the less important variable. <span class="citation">Dormann et al. (2013)</span> call this the <em>select07</em> method.</p>
<p>A <code>select07()</code> function is implemented in the package <code>mecofun</code> along with some other useful functions for the entire <em>Macroecology</em> module. We first have to install the package from the Univ. Potsdam gitlab:</p>
<pre class="r"><code>library(devtools)
devtools::install_git(&quot;https://gitup.uni-potsdam.de/macroecology/mecofun.git&quot;)</code></pre>
<p>Now, you can load the package and try out the function. Also, check out the help pages for <code>?select07</code>.</p>
<pre class="r"><code>library(mecofun)

# Run select07()
var_sel &lt;- select07(X=sp_dat[,-c(1:3)], 
                    y=sp_dat$Turdus_torquatus, 
                    threshold=0.7)

# Check out the structure of the resulting object:
str(var_sel)</code></pre>
<pre><code>## List of 3
##  $ AIC     : Named num [1:19] 182 187 191 196 223 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:19] &quot;bio11&quot; &quot;bio8&quot; &quot;bio1&quot; &quot;bio6&quot; ...
##  $ cor_mat : num [1:19, 1:19] 1 0.265 -0.259 0.444 0.844 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:19] &quot;bio1&quot; &quot;bio2&quot; &quot;bio3&quot; &quot;bio4&quot; ...
##   .. ..$ : chr [1:19] &quot;bio1&quot; &quot;bio2&quot; &quot;bio3&quot; &quot;bio4&quot; ...
##  $ pred_sel: chr [1:8] &quot;bio11&quot; &quot;bio8&quot; &quot;bio17&quot; &quot;bio10&quot; ...</code></pre>
<pre class="r"><code># We extract the names of the weakly correlated predictors ordered by the univariate variable importance in terms of AIC:
pred_sel &lt;- var_sel$pred_sel</code></pre>
<p>So, we have now reduced our set of 19 bioclimatic variables to 8 predictors that are only weakly correlated. Now, we need to decide whether all of these should be included in the final model, or if we select only a few, for example the two most important variables in terms of univariate AIC. As a rule of thumb, we should have ten presence points per parameter fitted in the model <span class="citation">(Guisan, Thuiller, and Zimmermann 2017)</span>.</p>
<pre class="r"><code># How many presence points do we have?
sum(sp_dat$Turdus_torquatus)</code></pre>
<pre><code>## [1] 43</code></pre>
<p>According to the rule of thumb, we can only include 4 parameters and want to include quadratic terms as well. Thus, for this example, we should only use two predictors. In our case, the best two predictors in terms of univariate AIC were bio11 and bio8.</p>
</div>
</div>
<div id="model-selection" class="section level2">
<h2><span class="header-section-number">4.5</span> Model selection</h2>
<p>Now that we have selected a set of weakly correlated variables, we can fit the full model and then simplify it. The latter is typically called model selection.</p>
<pre class="r"><code># Fit the full model:
m_full &lt;- glm( Turdus_torquatus ~ bio11 + I(bio11^2) + bio8 + I(bio8^2), 
               family=&#39;binomial&#39;, data=sp_dat)

# Inspect the model:
summary(m_full)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Turdus_torquatus ~ bio11 + I(bio11^2) + bio8 + 
##     I(bio8^2), family = &quot;binomial&quot;, data = sp_dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.69015  -0.26889  -0.15746  -0.07268   3.12362  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  1.710e+00  7.384e-01   2.315   0.0206 *
## bio11       -7.128e-02  7.333e-02  -0.972   0.3310  
## I(bio11^2)  -9.897e-04  1.397e-03  -0.709   0.4786  
## bio8        -4.124e-02  5.624e-02  -0.733   0.4635  
## I(bio8^2)    7.039e-05  4.500e-04   0.156   0.8757  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 294.43  on 506  degrees of freedom
## Residual deviance: 171.71  on 502  degrees of freedom
## AIC: 181.71
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>How much deviance is explained by our model? The function <code>expl_deviance()</code> is also contained in the <code>mecofun</code> package. As explained earlier, we can calculate explained deviance by quantifying how closely the model predictions fit the data in relation to the null model predictions.</p>
<pre class="r"><code># Explained deviance:
expl_deviance(obs = sp_dat$Turdus_torquatus,
              pred = m_full$fitted)</code></pre>
<pre><code>## [1] 0.4168184</code></pre>
<p>We can simplify the model further by using stepwise variable selection. The function <code>step()</code> uses the AIC to compare different subsets of the model. Specifically, it will iteratively drop variables and add variables until the AIC cannot be improved further (meaning it will not decrease further).</p>
<pre class="r"><code>m_step &lt;- step(m_full) </code></pre>
<pre class="r"><code># Inspect the model:
summary(m_step)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Turdus_torquatus ~ bio11 + bio8, family = &quot;binomial&quot;, 
##     data = sp_dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.78050  -0.27326  -0.17106  -0.08886   3.00796  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.86289    0.47867   3.892 9.95e-05 ***
## bio11       -0.11329    0.03107  -3.647 0.000266 ***
## bio8        -0.03293    0.01949  -1.690 0.091051 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 294.43  on 506  degrees of freedom
## Residual deviance: 172.20  on 504  degrees of freedom
## AIC: 178.2
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<pre class="r"><code># Explained deviance:
expl_deviance(obs = sp_dat$Turdus_torquatus,
              pred = m_step$fitted)</code></pre>
<pre><code>## [1] 0.4151411</code></pre>
<p>The final model only selected the linear terms for bio11 and bio8. The explained deviance is a tiny bit lower than for the quadratic model, but the linear model is more parsimonious.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-Austin1980">
<p>Austin, M. P. 1980. “Searching for a Model for Use in Vegetation Analysis.” <em>Vegetatio</em> 42 (October). Springer Nature: 11–21.</p>
</div>
<div id="ref-Dormann2013">
<p>Dormann, C. F., J. Elith, S. Bacher, C. Buchmann, G. Carl, G. Carre, J. R. Garcia Marquez, et al. 2013. “Collinearity: A Review of Methods to Deal with It and a Simulation Study Evaluating Their Performance.” <em>Ecography</em> 36: 27–46.</p>
</div>
<div id="ref-Elith2009">
<p>Elith, J., and J. R. Leathwick. 2009. “Species Distribution Models: Ecological Explanation and Prediction Across Space and Time.” <em>Annual Review of Ecology, Evolution, and Systematics</em> 40: 677–97.</p>
</div>
<div id="ref-elith2008">
<p>Elith, J., J. R. Leathwick, and T. Hastie. 2008. “A Working Guide to Boosted Regression Trees.” <em>Journal of Animal Ecology</em> 77: 802–13.</p>
</div>
<div id="ref-Elith2011">
<p>Elith, J., S. J. Phillips, T. Hastie, M. Dudik, Y. E. Chee, and C. J. Yates. 2011. “A Statistical Explanation of Maxent for Ecologists.” <em>Diversity and Distributions</em> 17: 43–57.</p>
</div>
<div id="ref-Franklin2010">
<p>Franklin, J. 2010. <em>Mapping Species Distributions: Spatial Inference and Prediction</em>. Cambride University Press.</p>
</div>
<div id="ref-Gillings2019">
<p>Gillings, Simon, Dawn E. Balmer, Brian J. Caffrey, Iain S. Downie, David W. Gibbons, Peter C. Lack, James B. Reid, J. Tim R. Sharrock, Robert L. Swann, and Robert J. Fuller. 2019. “Breeding and Wintering Bird Distributions in Britain and Ireland from Citizen Science Bird Atlases.” <em>Global Ecology and Biogeography</em> 28 (7): 866–74. <a href="https://doi.org/10.1111/geb.12906">https://doi.org/10.1111/geb.12906</a>.</p>
</div>
<div id="ref-guisan2005">
<p>Guisan, A., and W. Thuiller. 2005. “Predicting Species Distribution: Offering More Than Simple Habitat Models.” <em>Ecology Letters</em> 8: 993–1009.</p>
</div>
<div id="ref-Guisan2017">
<p>Guisan, A., W. Thuiller, and N. E. Zimmermann. 2017. <em>Habitat Suitability and Distribution Models with Applications in R</em>. Cambride University Press.</p>
</div>
<div id="ref-Guisan2000">
<p>Guisan, A., and N. E. Zimmermann. 2000. “Predictive Habitat Distribution Models in Ecology.” <em>Ecological Modelling</em> 135: 147–86.</p>
</div>
<div id="ref-Hosmer2013">
<p>Hosmer, David W., and Stanley Lemeshow. 2013. <em>Applied Logistic Regression</em>. 3rd ed. John Wiley &amp; Sons, Inc.</p>
</div>
<div id="ref-IPBES2016">
<p>IPBES. 2016. <em>The Methodological Assessment Report on Scenarios and Models of Biodiversity and Ecosystem Services</em>. Edited by S. Ferrier, K. N. Ninan, P. Leadley, R. Alkemade, L. A. Acosta, H. R. Akcakaya, L. Brotons, et al. Secretariat of the Intergovernmental Science-Policy Platform on Biodiversity; Ecosystem Services, Bonn, Germany.</p>
</div>
<div id="ref-Merow2013">
<p>Merow, C., M. J. Smith, and J. A. Silander Jr. 2013. “A Practical Guide to Maxent for Modeling Species’ Distributions: What It Does, and Why Inputs and Settings Matter.” <em>Ecography</em> 36: 1058–69.</p>
</div>
<div id="ref-Peterson2011a">
<p>Peterson, A. T., J. Soberon, R.G. Pearson, R. P. Anderson, E. Martinez-Meyer, M. Nakamura, and M. B. Araujo. 2011. <em>Ecological Niches and Geographic Distributions</em>. Princeton University Press.</p>
</div>
<div id="ref-phillips2006">
<p>Phillips, S. J., R. P. Anderson, and R. E. Schapire. 2006. “Maximum Entropy Modeling of Species Geographic Distributions.” <em>Ecological Modelling</em> 190: 231–59.</p>
</div>
<div id="ref-Thuiller2009">
<p>Thuiller, W., B. Lafourcade, R. Engler, and M. B. Araujo. 2009. “BIOMOD - a Platform for Ensemble Forecasting of Species Distributions.” <em>Ecography</em> 32: 369–73.</p>
</div>
<div id="ref-Zurell2020a">
<p>Zurell, Damaris, Janet Franklin, Christian König, Phil J. Bouchet, Carsten F. Dormann, Jane Elith, Guillermo Fandos, et al. 2020. “A Standard Protocol for Reporting Species Distribution Models.” <em>Ecography</em> 43 (9): 1261–77. <a href="https://doi.org/10.1111/ecog.04960">https://doi.org/10.1111/ecog.04960</a>.</p>
</div>
</div>
</div>

<!DOCTYPE html>
<html>

<br>
<hr />
<div id="footer">
<p>Damaris Zurell, 2020 <a href="http://creativecommons.org/licenses/by/4.0/" >(CC BY 4.0)</a>.  </p>
</div>

</html>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
